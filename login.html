<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login - Gitalk Forum</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="color-scheme" content="dark light" />
  <!-- <script src="https://oauth.io/auth/oauth.js"></script> -->
   <script src="https://cdnjs.cloudflare.com/ajax/libs/oauth-io/0.6.2/oauth.min.js" integrity="sha512-7vvcd3FgS/LUBJakuT2J5LsNx4FbBN0sJvqIpZlMhQZlbCuQrAHPwP99ksbr01eFHwfnHJxxjCDjXVbNlD7FSg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen flex flex-col text-gray-900 dark:text-gray-100">
  <nav class="bg-white/90 dark:bg-gray-800/90 shadow-lg px-6 py-3 flex justify-between items-center border-b border-blue-100 dark:border-gray-700">
    <a href="index.html" class="flex items-center gap-2 text-2xl font-extrabold text-blue-700 dark:text-blue-300 tracking-tight">
      <svg width="32" height="32" fill="none" viewBox="0 0 32 32"><circle cx="16" cy="16" r="16" fill="#2563eb"/><text x="50%" y="55%" text-anchor="middle" fill="#fff" font-size="18" font-family="Arial" dy=".3em">G</text></svg>
      <span>Gitalk Forum</span>
    </a>
  </nav>
  <main class="flex-1 flex flex-col items-center justify-center">
    <div id="login-container" class="bg-white/95 dark:bg-gray-800 border border-blue-100 dark:border-gray-700 p-10 rounded-2xl shadow-xl flex flex-col items-center gap-6 mt-20">
      <h1 class="text-3xl font-extrabold text-blue-800 dark:text-blue-200 mb-2">Login ke Gitalk Forum</h1>
      <p class="text-gray-600 dark:text-gray-300 mb-4 text-center">Login dengan akun GitHub untuk mulai berdiskusi dan membuat thread.</p>
      <a id="github-login-btn" href="#" class="bg-blue-600 text-white px-8 py-3 rounded-full shadow hover:bg-blue-700 font-semibold text-lg flex items-center gap-2">
        <svg width="24" height="24" fill="currentColor" class="inline-block mr-2" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.387.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.415-4.042-1.415-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.084-.729.084-.729 1.205.084 1.84 1.236 1.84 1.236 1.07 1.834 2.809 1.304 3.495.997.108-.775.418-1.305.762-1.605-2.665-.305-5.466-1.334-5.466-5.931 0-1.31.469-2.381 1.236-3.221-.124-.303-.535-1.523.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.553 3.297-1.23 3.297-1.23.653 1.653.242 2.873.119 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.803 5.624-5.475 5.921.43.371.823 1.102.823 2.222 0 1.606-.014 2.898-.014 3.293 0 .322.216.694.825.576C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
        Login dengan GitHub
      </a>
    </div>
    <div id="user-info" class="hidden flex flex-col items-center gap-4 mt-20">
      <img id="user-avatar" src="" alt="User Avatar" class="w-20 h-20 rounded-full border border-blue-200" />
      <p id="user-name" class="text-lg font-semibold text-blue-700 dark:text-blue-300"></p>
      <a href="logout.html" class="text-red-600 hover:text-red-800 font-semibold">Logout</a>
      <a href="index.html" class="bg-blue-600 text-white px-6 py-2 rounded-full shadow hover:bg-blue-700 font-semibold text-sm">Lihat thread</a>
    </div>
  </main>
  <button id="dark-toggle" type="button" class="fixed top-3 right-3 text-xs px-2 py-1 rounded border border-blue-200 dark:border-gray-600 bg-white/70 dark:bg-gray-700 text-blue-700 dark:text-blue-200 hover:bg-blue-50 dark:hover:bg-gray-600 z-50">üåô</button>
  <script>
    tailwind.config = { darkMode: 'class' };
  // --- CONFIG ---
  const OAUTHIO_PUBLIC_KEY = 'Xd-2JfmZeipjmugR8FNJHI1QRx0';

  // --- INIT OAUTH.IO ---
  OAuth.initialize(OAUTHIO_PUBLIC_KEY);

  // --- UI LOGIC ---
  function showUserInfo(user) {
    document.getElementById('login-container').classList.add('hidden');
    const userInfo = document.getElementById('user-info');
    document.getElementById('user-avatar').src = user.avatar_url || user.info.avatar_url || '';
    document.getElementById('user-name').textContent = user.login || user.name || user.info.name || user.email || '';
    userInfo.classList.remove('hidden');
    localStorage.setItem('github_user', JSON.stringify(user));
  }

  function logout() {
    localStorage.removeItem('github_access_token');
    localStorage.removeItem('github_user');
    window.location.reload();
  }

  // --- CHECK LOGIN ---
  const githubToken = localStorage.getItem('github_access_token');
  const githubUser = localStorage.getItem('github_user');
  if (githubToken && githubUser) {
    showUserInfo(JSON.parse(githubUser));
  } else {
    document.getElementById('login-container').classList.remove('hidden');
    document.getElementById('user-info').classList.add('hidden');
  }

  // --- LOGIN BUTTON ---
document.getElementById('github-login-btn').onclick = function(e) {
  e.preventDefault();
  OAuth.popup('github', {
    cache: true,
    scope: 'repo'
  }, function(err, result) {
    if (err) {
      alert('Login gagal: ' + (err.message || err));
      console.error('OAuth.io error:', err);
      return;
    }
    // Ambil data user GitHub langsung via API
    fetch('https://api.github.com/user', {
      headers: {
        'Authorization': 'token ' + result.access_token,
        'Accept': 'application/vnd.github+json'
      }
    })
    .then(function(res) { return res.json(); })
    .then(function(user) {
      localStorage.setItem('github_access_token', result.access_token);
      localStorage.setItem('github_user', JSON.stringify(user));
      showUserInfo(user);
    })
    .catch(function(fetchErr) {
      alert('Gagal ambil data user GitHub: ' + (fetchErr.message || fetchErr));
      console.error('GitHub API error:', fetchErr);
    });
  });
};

  // // --- LOGOUT BUTTON ---
  // document.getElementById('user-info').querySelector('a[href="logout.html"]').onclick = function(e) {
  //   e.preventDefault();
  //   logout();
  // };



  // --- DARK MODE ---
  
  let btnDark = document.getElementById('dark-toggle');
  if (btnDark) btnDark.onclick = function() {
    if (document.documentElement.classList.contains('dark')) {
      document.documentElement.classList.remove('dark');
      localStorage.setItem('theme', 'light');
      btnDark.textContent = 'üåô';
    } else {
      document.documentElement.classList.add('dark');
      localStorage.setItem('theme', 'dark');
      btnDark.textContent = '‚òÄÔ∏è';
    }
  };
  (function() {
    var theme = localStorage.getItem('theme');
    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
      btnDark.textContent = '‚òÄÔ∏è';
    } else if (theme === 'light') {
      document.documentElement.classList.remove('dark');
      btnDark.textContent = 'üåô';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
      btnDark.textContent = '‚òÄÔ∏è';
    } else {
      document.documentElement.classList.remove('dark');
      btnDark.textContent = 'üåô';
    }
  })();

</script>
</body>
</html>
